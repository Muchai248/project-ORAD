{% load static %}
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Dashboard V.1 |</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- favicon
		============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'img/logo/logo1.jpeg' %}">
    <!-- Google Fonts
		============================================ -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
    <!-- Bootstrap CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/font-awesome.min.css'  %}" />
    <!-- owl.carousel CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.css'  %}">
    <link rel="stylesheet" href="{% static 'css/owl.transitions.css' %}">
    <!-- animate CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <!-- normalize CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
    <!-- meanmenu icon CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/meanmenu.min.css' %}">
    <!-- main CSS
		============================================ -->
    <link rel="stylesheet" href="{% static  'css/main.css' %}">
    <!-- educate icon CSS
		============================================ -->
    <link rel="stylesheet" href="{%  static 'css/educate-custon-icon.css' %}">
    <!-- morrisjs CSS
		============================================ -->
    <link rel="stylesheet" href="{%  static 'css/morrisjs/jquery.morris.min.css' %}">
    <!-- mCustomScrollbar CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/scrollbar/jquery.mCustomScrollbar.min.css' %}">
    <!-- metisMenu CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/metisMenu/metisMenu.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/metisMenu/metisMenu-vertical.css' %}">
    <!-- calendar CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/calendar/fullcalendar.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/calendar/fullcalendar.print.min.css' %}">
    <!-- style CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- responsive CSS
		============================================ -->
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <!-- Font Awesome -->
    <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    rel="stylesheet"
    />
    <!-- MDB -->
    <link
    href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css"
    rel="stylesheet"
    />
    <!-- modernizr JS
		============================================ -->
    <script src="{% static 'js/vendor/modernizr-2.8.3.min.js' %}"></script>
    <style> body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

.container {
    width: 100%;
    margin: 0 auto;
    padding: 20px;
}

.site-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.site-card {
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.upload-button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 8px 16px;
    cursor: pointer;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 20% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.site-card {
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 20px;
    background-color: #f9f9f9;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.site-card h3 {
    font-size: 18px;
    margin-bottom: 10px;
}

.upload-container {
    margin-top: 10px;
}

.upload-button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.upload-button:hover {
    background-color: #0056b3;
}

.button-container {
    margin-top: 10px;
}

.view-button {
    background-color: #28a745;
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.view-button:hover {
    background-color: #218838;
}

.documents {
    margin-top: 10px;
}

.documents a {
    display: block;
    margin-bottom: 5px;
    color: #007bff;
    text-decoration: none;
}

.documents a:hover {
    text-decoration: underline;
    color: #0056b3;
}
.site{
    float: right;
    margin: auto 0;
}
.site button{
    background-color: orange;
    text-align: center;
}

.popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    .popup-card {
      width: 300px;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
    }
</style>
</head>

<body>
<div class="all-content-wrappe">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Navbar</a>
          <button
            data-mdb-collapse-init
            class="navbar-toggler"
            type="button"
            data-mdb-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i class="fas fa-bars"></i>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">My Files</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Q.C</a>
              </li>
              <li class="nav-item">
                <a class="nav-link "
                  >Documents</a
                >
              </li>
            </ul>
          </div>
        </div>
        <!-- Button to add new site -->
        <div class="site">
            <button class="btn btn-warning" onclick="togglePopup()"  data-bs-toggle="modal" data-bs-target="#exampleModal">Add New Site</button>
            <div class="popup" id="popup">
                <div class="popup-card">
                  <span class="close-btn" onclick="togglePopup()">&times;</span>
                  <h2>Popup Title</h2>
                  <p>Popup Content</p>
                </div>
              </div>
              
      </nav>
    <!-- Modal for displaying site details -->
  <div class="container">
        <h1>Site QC Documents</h1>
        <div id="siteList" class="site-list">
            <!-- Render site cards dynamically -->
            <!-- Sample site data and form data -->
            <div class="site-card">
                <h3></h3>
                <div class="upload-container">
                    <form method="post" enctype="multipart/form-data" action="/upload-file/" class="uploadForm">
                        <!-- CSRF token -->
                        <input type="hidden" name="csrfmiddlewaretoken" value="your_csrf_token_here">
                        <input type="file" name="file" class="fileInput" style="display: none;">
                        <button class="upload-button" type="submit" data-id="1">
                            <div id="one"></div>
                            <span>Upload Document</span>
                        </button>
                    </form>
                    <div class="button-container">
                        <button class="view-button" data-id="1">View Documents</button>
                    </div>
                    <div class="documents"></div>
                </div>
            </div>
            <!-- End of Sample site data -->

            <!-- You can add more site cards here -->
        </div>
    </div>

   
 <!-- Popup card for displaying documents -->
<div id="popupCard" class="popup-card">
    <span class="close">&times;</span>
    <div class="popup-content">
        <h2></h2>
        <div id="documentsList"></div>
    </div>
</div>


{% load static %}
    <!-- jquery
		============================================ -->
    <script src="{% static 'js/vendor/jquery-1.12.4.min.js' %}"></script>
    <!-- bootstrap JS
		============================================ -->
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- wow JS
		============================================ -->
    <script src="{% static 'js/wow.min.js' %}"></script>
    <!-- price-slider JS
		============================================ -->
    <script src="{% static 'js/jquery-price-slider.js' %}"></script>
    <!-- meanmenu JS
		============================================ -->
    <script src="{% static 'js/jquery.meanmenu.js' %}"></script>
    <!-- owl.carousel JS
		============================================ -->
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <!-- sticky JS
		============================================ -->
    <script src="{% static 'js/jquery.sticky.js' %}"></script>
    <!-- scrollUp JS
		============================================ -->
    <script src="{% static 'js/jquery.scrollUp.min.js' %}"></script>
    <!-- counterup JS
		============================================ -->
    <script src="{% static 'js/counterup/jquery.counterup.min.js' %}" ></script>
    <script src="{% static 'js/counterup/waypoints.min.js' %}"></script>
    <script src="{% static 'js/counterup/counterup-active.js' %}"></script>
    <!-- mCustomScrollbar JS
		============================================ -->
    <script src="{% static 'js/scrollbar/jquery.mCustomScrollbar.concat.min.js' %}"></script>
    <script src="{% static 'js/scrollbar/mCustomScrollbar-active.js' %}"></script>
    <!-- metisMenu JS
		============================================ -->
    <script src="{% static 'js/metisMenu/metisMenu.min.js' %}"></script>
    <script src="{% static 'js/metisMenu/metisMenu-active.js' %}"></script>
    <!-- morrisjs JS
		============================================ -->
    <script src="{% static 'js/morrisjs/raphael-min.js' %}"></script>
    <script src="{% static 'js/morrisjs/morris.js' %}"></script>
    <script src="{% static 'js/morrisjs/morris-active.js' %}"></script>
    <!-- morrisjs JS
		============================================ -->
    <script src="{% static 'js/sparkline/jquery.sparkline.min.js' %}"></script>
    <script src="{% static 'js/sparkline/jquery.charts-sparkline.js' %}"></script>
    <script src="{% static 'js/sparkline/sparkline-active.js' %}"></script>
    <!-- calendar JS
		============================================ -->
    <script src="{% static 'js/calendar/moment.min.js'  %}" ></script>
    <script src="{%  static 'js/calendar/fullcalendar.min.js'  %}" ></script>
    <script src="{% static  'js/calendar/fullcalendar-active.js' %}"></script>
    <!-- plugins JS
		============================================ -->
    <script src="{% static  'js/plugins.js' %}"></script>
    <!-- main JS
		============================================ -->
    <script src="{% static    'js/main.js' %}"></script>
    <script>
    // Sample site data
const sites = [
    { id: 1, name: 'ACK ST James Cathedral,Kiambu', documents: [] },
    { id: 2, name: 'ACK ST Peter Cathedral,Kenol', documents: [] },
    { id: 3, name: 'ACK Mariiki', documents: [] },
    { id: 4, name: 'AIC WOTE,Makueni', documents: [] },
    { id: 5, name: 'ST Joseph W. Catholic', documents: [] },
    { id: 6, name: 'Mirema Apartments', documents: [] },
    { id: 7, name: 'Ruiru Mud Block', documents: [] },
    { id: 8, name: 'R110 Tatu City Maisonnette', documents: [] },
    { id: 9, name: 'Kamulu Maisonnette', documents: [] },
    { id: 10, name: 'Kericho Bungalow', documents: [] }
];

document.addEventListener('DOMContentLoaded', function () {
    // Add event listeners to all "View Documents" buttons
    const viewButtons = document.querySelectorAll('.view-button');
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            const siteId = this.getAttribute('data-id');
            fetchDocumentsForSite(siteId);
        });
    });
});


// Function to display documents in a popup
function displayDocumentsPopup(documents) {
    // Populate the popup window with documents
    const popup = document.getElementById('popupWindow');
    const documentsContainer = popup.querySelector('.documents');
    documentsContainer.innerHTML = ''; // Clear previous content

    // Create HTML elements for each document
    documents.forEach(document => {
        const documentItem = document.createElement('div');
        documentItem.textContent = document.name; // Adjust based on your document structure
        documentsContainer.appendChild(documentItem);
    });

    // Show the popup window
    popup.style.display = 'block';
}

// Function to render the list of sites
function renderSiteList() {
    const siteList = document.getElementById('siteList');
    siteList.innerHTML = ''; // Clear previous content

    sites.forEach(site => {
        const siteCard = document.createElement('div');
        siteCard.classList.add('site-card');
        siteCard.innerHTML = `
            <h3>${site.name}</h3>
            <div class="upload-container">
                <form method="post" enctype="multipart/form-data" action="/upload-file/" class="uploadForm">
                {% csrf_token %}
                    <input type="file" name="file" class="fileInput" style="display: none;">
                    <button class="upload-button" type="button" data-id="${site.id}">
                        <div id="one"></div>
                        <span>Upload Document</span>
                    </button>
                </form>
                <div class="button-container">
                    <button class="view-button" data-id="${site.id}">View Documents</button>
                    </div>
                   <div class="documents"></div>
            </div>
            <div class="documents"></div>
        `;
        siteList.appendChild(siteCard);

          // Add event listeners for view buttons
    document.querySelectorAll('.view-button').forEach(button => {
        button.addEventListener('click', () => {
            const siteId = button.getAttribute('data-id');
            fetchAndDisplayDocuments(siteId);
        });
    });

        // Add event listener to upload button
        const uploadButton = siteCard.querySelector('.upload-button');
        uploadButton.addEventListener('click', () => {
            const fileInput = siteCard.querySelector('.fileInput');
            fileInput.click();
        });

        // Add event listener to file input
        const fileInput = siteCard.querySelector('.fileInput');
        fileInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const siteId = uploadButton.getAttribute('data-id');
                uploadDocument(siteId, file);
            } else {
                alert('Please select a file to upload.');
            }
        });
    });
}

// Function to open the upload document modal
function openUploadModal(siteId) {
    const modal = document.getElementById('uploadFormModal');
    const closeButton = modal.querySelector('.close');
    const uploadForm = modal.querySelector('#uploadForm');

    modal.style.display = 'block';

    // Close the modal when the close button is clicked
    closeButton.onclick = () => modal.style.display = 'none';

    // Close the modal when the user clicks outside of it
    window.onclick = (event) => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };

    // Submit the upload form
    uploadForm.onsubmit = (event) => {
        event.preventDefault();
        const fileInput = uploadForm.querySelector('#document');
        const file = fileInput.files[0];
        if (file) {
            uploadDocument(siteId, file);
            modal.style.display = 'none';
            fileInput.value = ''; // Clear the file input
        } else {
            alert('Please select a file to upload.');
        }
    };
}
document.addEventListener('DOMContentLoaded', function () {
    // Get the upload buttons and file inputs for each site
    const uploadButtons = document.querySelectorAll('.upload-button');
    const fileInputs = document.querySelectorAll('.fileInput');
    
    // Add click event listener to each upload button
    uploadButtons.forEach(uploadButton => {
        uploadButton.addEventListener('click', function() {
            // Get the corresponding file input for this site
            const fileInput = this.parentElement.querySelector('.fileInput');
            // Trigger click event on the file input
            fileInput.click();
        });
    });

    // Add change event listener to each file input to submit the form when a file is selected
    fileInputs.forEach(fileInput => {
        fileInput.addEventListener('change', function() {
            // Get the corresponding form for this site
            const uploadForm = this.parentElement;
            // Submit the form when a file is selected
            uploadForm.submit();
        });
    });

    // Fetch documents for display
    fetchDocuments();
});

// Function to fetch documents for a specific site
function fetchDocumentsForSite(siteId) {
    fetch(`http://localhost:8000/qc-documents/?site_id=${siteId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Render the documents in the popup card
            renderDocumentsInPopup(data);
        })
        .catch(error => {
            console.error('Error fetching documents:', error.message);
        });
}

// Function to render documents in the popup card
function renderDocumentsInPopup(documents) {
    const documentsList = document.getElementById('documentsList');
    documentsList.innerHTML = ''; // Clear previous content

    documents.forEach(document => {
        const documentLink = document.createElement('a');
        documentLink.href = document.document;
        documentLink.textContent = document.document_name;
        documentLink.setAttribute('download', '');
        
        const br = document.createElement('br');

        documentsList.appendChild(documentLink);
        documentsList.appendChild(br);
    });

    // Display the popup card
    const popupCard = document.getElementById('popupCard');
    popupCard.style.display = 'block';
}

// Event listener for closing the popup card
document.querySelector('.close').addEventListener('click', function() {
    document.getElementById('popupCard').style.display = 'none';
});

// Event listener for "View" button/link in each site card
document.querySelectorAll('.view-button').forEach(button => {
    button.addEventListener('click', function() {
        const siteId = this.getAttribute('data-id');
        fetchDocumentsForSite(siteId);
    });
});

// Function to upload the document
function uploadDocument(siteId, file) {
    const site = sites.find(site => site.id === siteId);
    site.documents.push({ name: file.name, url: URL.createObjectURL(file) });
    renderDocuments(siteId);
}

// Function to render documents for a site
function renderDocuments(siteId) {
    const siteCard = document.querySelector(`.site-card[data-id="${siteId}"]`);
    const documentsDiv = siteCard.querySelector('.documents');
    documentsDiv.innerHTML = ''; // Clear previous documents

    const site = sites.find(site => site.id === siteId);
    site.documents.forEach(document => {
        const documentLink = document.createElement('a');
        documentLink.href = document.url;
        documentLink.textContent = document.name;
        documentLink.setAttribute('download', '');

        const br = document.createElement('br');

        documentsDiv.appendChild(documentLink);
        documentsDiv.appendChild(br);
    });
}
function togglePopup() {
    const popup = document.getElementById('popup');
    popup.style.display = popup.style.display === 'flex' ? 'none' : 'flex';
  }
// Render the site list when the page loads
window.onload = renderSiteList;
</script>

</body>

</html>